<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>H-Coin Pro Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #ffd700;
            --blue: #00bfff;
            --bronze: #cd7f32;
            --purple: #9d00ff; /* Ù„ÙˆÙ† Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… Ø§Ù„Ù…Ù…ÙŠØ² */
            --bg: #000000;
            --surface: #1c1c1e;
            --surface-light: #2c2c2e;
            --text: #ffffff;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * {
            -webkit-user-select: none; user-select: none; -webkit-touch-callout: none;
            box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif;
            margin: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
            transition: background 0.5s;
        }

        /* --- Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¬Ø© --- */
        body.rank-bronze { background: radial-gradient(circle at center, #2c1810 0%, #000 100%); }
        body.rank-silver { background: radial-gradient(circle at center, #3a3a3a 0%, #000 100%); }
        body.rank-gold { background: radial-gradient(circle at center, #3a2a03 0%, #000 100%); }
        body.rank-diamond { background: radial-gradient(circle at center, #0f0c29 0%, #000 100%); }
        
        /* Ø®Ù„ÙÙŠØ© Ø®Ø§ØµØ© Ù„Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… */
        body.is-premium { background: radial-gradient(circle at center, #2e003e 0%, #000 100%) !important; border: 2px solid var(--purple); }

        body.turbo-active { background: radial-gradient(circle at center, #551a00 0%, #000 100%) !important; }

        /* --- Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© --- */
        .btn-primary {
            background: var(--gold); color: #000; border: none; padding: 12px 20px;
            border-radius: 12px; font-weight: 900; width: 100%; cursor: pointer;
            transition: transform 0.1s; font-size: 16px;
        }
        .btn-primary:active { transform: scale(0.95); }
        .btn-primary:disabled { background: #444; color: #888; cursor: not-allowed; }

        .btn-check {
            background: var(--blue); color: white;
        }

        /* Ø²Ø± Ø®Ø§Øµ Ù„Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… */
        .btn-premium {
            background: linear-gradient(45deg, #9d00ff, #ff00cc);
            color: white; box-shadow: 0 0 15px var(--purple);
            margin-top: 10px;
        }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ --- */
        .game-stage {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: space-evenly; padding-top: var(--safe-top);
            padding-bottom: calc(90px + var(--safe-bottom)); width: 100%;
        }

        .score-container { text-align: center; z-index: 10; }
        .league-badge {
            background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px;
            font-size: 14px; color: #ccc; margin-bottom: 5px; display: inline-block;
            backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1);
        }
        .score-val { font-size: clamp(45px, 12vw, 70px); font-weight: 900; line-height: 1; }

        .coin-btn {
            width: min(45vh, 85vw); height: min(45vh, 85vw);
            max-width: 360px; max-height: 360px;
            border-radius: 50%; cursor: pointer; position: relative; z-index: 5;
            transform-style: preserve-3d; transition: transform 0.1s;
        }
        .coin-inner {
            width: 100%; height: 100%; border-radius: 50%; overflow: hidden;
            border: 4px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.3);
            position: relative;
        }
        .coin-inner img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        .coin-inner.turbo { border-color: #ff4500; box-shadow: 0 0 80px #ff4500; animation: shake 0.5s infinite; }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø© */
        .is-premium .coin-inner { border-color: var(--purple); box-shadow: 0 0 60px var(--purple); }

        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(2deg); } 75% { transform: rotate(-2deg); } }

        .energy-hud { width: 85%; max-width: 400px; }
        .energy-bar { background: #333; height: 12px; border-radius: 6px; overflow: hidden; margin-top: 5px; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, var(--gold), orange); width: 100%; transition: width 0.2s; }
        .is-premium .energy-fill { background: linear-gradient(90deg, var(--purple), #ff00cc); }

        /* --- Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ --- */
        .nav-bar {
            position: fixed; bottom: calc(10px + var(--safe-bottom)); left: 50%; transform: translateX(-50%);
            width: 96%; max-width: 500px; background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px); border-radius: 25px; display: flex;
            justify-content: space-between; padding: 10px 10px; z-index: 100;
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            background: none; border: none; color: #666; font-size: 10px; font-weight: 700;
            transition: 0.3s; width: 18%; /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ù„ÙŠÙ†Ø§Ø³Ø¨ 5 Ø¹Ù†Ø§ØµØ± */
        }
        .nav-item svg { width: 22px; height: 22px; fill: currentColor; }
        .nav-item.active { color: var(--gold); transform: translateY(-2px); }

        /* --- Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… (Modals) --- */
        .section {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100dvh;
            background: var(--bg); z-index: 50; overflow-y: auto;
            padding: calc(20px + var(--safe-top)) 20px calc(100px + var(--safe-bottom));
        }
        .section-title { font-size: 24px; font-weight: 900; text-align: center; margin-bottom: 20px; color: var(--text); }
        
        .card {
            background: var(--surface); border-radius: 16px; padding: 15px;
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05);
        }

        /* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ --- */
        .profile-header { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-bottom: 20px; }
        .avatar {
            width: 80px; height: 80px; border-radius: 50%; background: #333;
            border: 3px solid var(--gold); overflow: hidden; display: flex; align-items: center; justify-content: center;
            font-size: 30px; color: #fff; font-weight: bold;
        }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        .user-details { text-align: center; }
        .user-tag { color: #888; font-size: 14px; margin-top: 4px; }
        
        .info-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #333; font-size: 14px; }
        .info-row:last-child { border-bottom: none; }
        .info-label { color: #aaa; }
        .info-val { color: #fff; font-weight: bold; font-family: monospace; }
        
        .wallet-btn {
            background: #007aff; color: white; border: none; padding: 12px; width: 100%;
            border-radius: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-top: 10px;
        }

        /* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… (Earn) --- */
        .daily-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 20px; }
        .daily-item {
            background: var(--surface-light); border-radius: 10px; padding: 10px 5px;
            text-align: center; opacity: 0.5; border: 1px solid transparent;
        }
        .daily-item.active { opacity: 1; border-color: var(--gold); background: rgba(255, 215, 0, 0.1); }
        .daily-item.claimed { opacity: 0.5; background: #222; color: #444; text-decoration: line-through; }
        .daily-day { font-size: 10px; color: #aaa; margin-bottom: 5px; }
        .daily-val { font-size: 12px; font-weight: bold; color: var(--gold); }

        .task-row {
            display: flex; align-items: center; justify-content: space-between;
            background: var(--surface); padding: 12px; border-radius: 12px; margin-bottom: 10px;
        }
        .task-icon { font-size: 24px; margin-left: 10px; }
        .task-info { flex: 1; }
        .task-title { font-size: 14px; font-weight: bold; }
        .task-reward { font-size: 12px; color: var(--gold); }

        /* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø± --- */
        .shop-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
        }
        .shop-item {
            background: var(--surface-light); border-radius: 12px; padding: 15px;
            text-align: center; border: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column; align-items: center; justify-content: space-between; height: 180px;
        }
        .shop-img { width: 60px; height: 60px; background: #444; border-radius: 50%; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;}
        .shop-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
        .shop-price { color: var(--gold); font-size: 12px; margin-bottom: 10px; }

        /* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù„ÙŠØ¯Ø±Ø¨ÙˆØ±Ø¯ --- */
        .leaderboard-row {
            display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #333;
        }
        .rank-num { width: 30px; font-weight: bold; color: #888; }
        .rank-1 { color: var(--gold); }
        .rank-2 { color: silver; }
        .rank-3 { color: #cd7f32; }
        .lb-user { flex: 1; display: flex; align-items: center; gap: 10px; }
        .lb-avatar { width: 30px; height: 30px; border-radius: 50%; background: #444; color: #fff; text-align: center; line-height: 30px; font-size: 12px;}
        .lb-score { font-weight: bold; color: var(--gold); font-size: 14px; }

        /* --- Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© --- */
        .particle {
            position: absolute; pointer-events: none; animation: pop 0.8s ease-out forwards;
            font-weight: 900; font-size: 28px; color: white; z-index: 100;
        }
        @keyframes pop {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0.5); opacity: 0; }
        }

        .turbo-rocket {
            position: absolute; font-size: 50px; cursor: pointer; z-index: 99;
            animation: float 4s ease-in-out infinite;
        }
    </style>
</head>
<body class="rank-bronze">

    <div id="mine-section" class="game-stage">
        <div class="score-container">
            <div class="league-badge" id="league-display">Bronze I</div>
            <div class="score-val"><span id="score">0</span></div>
        </div>

        <div class="coin-btn" id="coin-btn">
            <div class="coin-inner" id="coin-visual">
                <img src="https://raw.githubusercontent.com/halthalk/car/cfdeeba8911952a1ec29378f39476f1cec9c649e/20260114_190253.png" draggable="false">
            </div>
        </div>

        <div class="energy-hud">
            <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:bold; color:#ccc;">
                <span>âš¡ Energy</span>
                <span><span id="curr-energy">1000</span> / <span id="max-energy">1000</span></span>
            </div>
            <div class="energy-bar"><div class="energy-fill" id="energy-fill"></div></div>
        </div>
    </div>

    <div id="profile-section" class="section">
        <h2 class="section-title">My Profile</h2>
        
        <div class="card profile-header">
            <div class="avatar" id="profile-avatar">U</div>
            <div class="user-details">
                <h3 style="margin:0;" id="profile-name">Loading...</h3>
                <div class="user-tag" id="profile-username">@username</div>
                <div id="premium-status-text" style="color:var(--purple); font-weight:bold; display:none; margin-top:5px;">ğŸ’ H-Coin Premium</div>
            </div>
            <button class="wallet-btn" onclick="connectWallet()">
                <span>ğŸ’¼</span> Connect Wallet
            </button>
        </div>

        <h3 style="margin-bottom:10px;">Telegram Info</h3>
        <div class="card">
            <div class="info-row">
                <span class="info-label">User ID</span>
                <span class="info-val" id="profile-id">---</span>
            </div>
            <div class="info-row">
                <span class="info-label">Language</span>
                <span class="info-val" id="profile-lang">---</span>
            </div>
            <div class="info-row">
                <span class="info-label">Premium</span>
                <span class="info-val" id="profile-premium" style="color:#ff4500;">No</span>
            </div>
            <div class="info-row">
                <span class="info-label">Total Taps</span>
                <span class="info-val" id="profile-taps">0</span>
            </div>
            <div class="info-row">
                <span class="info-label">Invites</span>
                <span class="info-val" id="profile-invites">0</span>
            </div>
        </div>

        <h3 style="margin-bottom:10px;">ğŸ† Leaderboard</h3>
        <div class="card" id="leaderboard-list">
            </div>
    </div>

    <div id="earn-section" class="section">
        <h2 class="section-title">Earn Coins</h2>
        
        <div class="card" style="background: linear-gradient(135deg, #1c1c1e, #2a2a2a); border: 1px solid var(--blue);">
            <h3 style="margin-top:0;">ğŸ¤ Invite Friends</h3>
            <p style="font-size:13px; color:#aaa;">Invite friends to H-Coin Robot and get <span style="color:var(--gold); font-weight:bold;">500 Coins</span> per friend!</p>
            <button class="btn-primary" style="background:var(--blue); color:white;" onclick="inviteFriend()">ğŸ”— Share Invite Link</button>
        </div>
        
        <div class="card">
            <h3 style="margin-top:0;">ğŸ“… Daily Rewards</h3>
            <div class="daily-grid" id="daily-grid">
                </div>
            <button class="btn-primary" id="btn-claim-daily" onclick="claimDaily()" disabled>Check Next Reward</button>
        </div>

        <h3 style="margin-bottom:10px;">ğŸš€ Tasks List</h3>
        <div id="tasks-list">
            </div>
    </div>

    <div id="boosts-section" class="section">
        <h2 class="section-title">Boosters</h2>
        
        <div class="card" style="border: 2px solid var(--purple); background: rgba(157, 0, 255, 0.1);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; color:white;">ğŸ‘‘ H-Coin Premium</h3>
                <span style="font-size:24px;">ğŸ’</span>
            </div>
            <p style="font-size:12px; color:#ccc; margin:10px 0;">
                - 2x Multiplier per tap<br>
                - Exclusive Purple Look<br>
                - +5000 Max Energy Bonus
            </p>
            <button class="btn-primary btn-premium" id="btn-buy-premium" onclick="buyPremium()">
                Buy for 200,000 Coins
            </button>
        </div>

        <h3 style="margin:10px 0;">Normal Upgrades</h3>
        <div id="boosts-list">
            </div>
    </div>

    <div id="shop-section" class="section">
        <h2 class="section-title">Shop (Skins)</h2>
        <p style="text-align:center; color:#888; margin-bottom:20px;">Customize your coin look!</p>
        
        <div class="shop-grid">
            <div style="grid-column: 1 / -1; text-align: center; color: #666; padding: 40px; border: 1px dashed #333; border-radius: 12px;">
                <div style="font-size: 40px; margin-bottom: 10px;">ğŸ›ï¸</div>
                No items available yet.<br>
                <span style="color: var(--gold);">Coming Soon!</span>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-item active" onclick="nav('mine', this)">
            <svg viewBox="0 0 24 24"><path d="M12 2L2 22h20L12 2zm0 3.5L18.5 20H5.5L12 5.5z"/></svg>
            Mine
        </button>
        <button class="nav-item" onclick="nav('earn', this)">
            <svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
            Earn
        </button>
        <button class="nav-item" onclick="nav('boosts', this)">
            <svg viewBox="0 0 24 24"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.5 2.54l2.53 1.27c.63-1.21 1-2.6 1-4.06 0-5.36-4.34-9.7-9-9.7zM12 18c-3.31 0-6-2.69-6-6 0-1.65.67-3.15 1.76-4.24L6.34 6.34C4.9 7.79 4 9.79 4 12c0 4.42 3.58 8 8 8 2.21 0 4.21-.9 5.66-2.34l-1.42-1.42C15.15 17.33 13.65 18 12 18zm.3-15.05h-1.7v3.08c-2.84.48-5.2 2.65-5.96 5.47h3.04c.55-1.2 1.63-2.07 2.92-2.07v-6.48z"/></svg>
            Boosts
        </button>
        <button class="nav-item" onclick="nav('shop', this)">
            <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
            Shop
        </button>
        <button class="nav-item" onclick="nav('profile', this)">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            Profile
        </button>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();
    tg.setHeaderColor('#000000'); tg.setBackgroundColor('#000000');

    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· ---
    const BOT_USERNAME = "H_CoinRobot"; 
    const COMMUNITY_LINK = "https://t.me/Hcoin_Community";
    const PREMIUM_COST = 200000;

    // --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ---
    let gameData = {
        score: 0, energy: 1000, maxEnergy: 1000, tapValue: 1, regenRate: 1,
        lastSave: Date.now(), totalTaps: 0,
        isPremium: false,
        invites: 0, // Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª
        upgrades: { multitap: 1, energy: 1, speed: 1, bot: 0 },
        daily: { streak: 0, lastClaim: 0 },
        tasks: [], // IDs of claimed tasks
        startedTasks: [] // IDs of tasks that user clicked start on
    };

    const BOOSTS = {
        multitap: { name: "Multitap", base: 500, desc: "+1 per tap" },
        energy: { name: "Energy Limit", base: 1000, desc: "+500 max energy" },
        speed: { name: "Recharging", base: 2000, desc: "Faster energy" },
        bot: { name: "Tap Bot", base: 50000, desc: "Auto mine offline" }
    };

    const TASKS_DB = [
        { id: 'tg_chan', title: 'Join H-Coin Community', reward: 5000, url: COMMUNITY_LINK },
        { id: 'twitter', title: 'Follow on X', reward: 5000, url: 'https://twitter.com' },
        { id: 'share_story', title: 'Share in Story', reward: 10000, url: 'STORY_SHARE' } // Special ID for story
    ];

    let turboActive = false;

    // --- Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ---
    function init() {
        const saved = localStorage.getItem('hcoin_pro_v2'); 
        if (saved) {
            let parsed = JSON.parse(saved);
            Object.assign(gameData, parsed);
            if(!gameData.startedTasks) gameData.startedTasks = [];
            if(!gameData.invites) gameData.invites = 0;

            let seconds = (Date.now() - gameData.lastSave) / 1000;
            gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + (seconds * gameData.regenRate));
            if(gameData.upgrades.bot > 0 && seconds > 60) {
                let earned = Math.floor(seconds * gameData.upgrades.bot);
                if(gameData.isPremium) earned *= 2; 

                if(earned > 0) {
                    gameData.score += earned;
                    tg.showAlert(`ğŸ¤– Bot mined ${earned.toLocaleString()} coins while you were away!`);
                }
            }
        }
        
        setupProfile();
        checkPremiumVisuals();
        renderBoosts();
        renderDaily();
        renderTasks();
        renderLeaderboard();
        updateUI();
        setInterval(saveGame, 2000);
        setInterval(regenEnergy, 1000);
        scheduleRocket();
    }

    // --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ---
    function setupProfile() {
        const user = tg.initDataUnsafe.user || { first_name: "Guest", username: "guest", id: "000000", language_code: "en" };
        
        document.getElementById('profile-name').innerText = user.first_name + (user.last_name ? ' ' + user.last_name : '');
        document.getElementById('profile-username').innerText = user.username ? '@' + user.username : 'No Username';
        document.getElementById('profile-id').innerText = user.id;
        document.getElementById('profile-lang').innerText = (user.language_code || 'en').toUpperCase();
        
        if(gameData.isPremium) {
            const premEl = document.getElementById('profile-premium');
            premEl.innerText = "H-COIN VIP ğŸ’"; premEl.style.color = "#9d00ff";
        }

        if(user.photo_url) {
            document.getElementById('profile-avatar').innerHTML = `<img src="${user.photo_url}">`;
        } else {
            document.getElementById('profile-avatar').innerText = user.first_name.charAt(0);
        }
    }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ§Øª + Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªÙˆØ±ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
    function inviteFriend() {
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "000";
        const inviteLink = `https://t.me/${BOT_USERNAME}?start=ref_${userId}`;
        const shareText = `ğŸš€ Join me on H-Coin Pro! Mine coins and compete.\n\nğŸ‘‡ Start here:\n${inviteLink}`;
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (ØªØ¸Ù‡Ø± Ø®ÙŠØ§Ø± Story ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ ØªÙ„ÙŠØ¬Ø±Ø§Ù…)
        const fullUrl = `https://t.me/share/url?url=${encodeURIComponent(inviteLink)}&text=${encodeURIComponent(shareText)}`;
        tg.openTelegramLink(fullUrl);

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯Ø¹ÙˆØ§Øª
        setTimeout(() => {
            gameData.invites++;
            gameData.score += 500;
            tg.showAlert("Invite link opened! You received +500 Coins reward and +1 Invite (Simulation).");
            updateUI();
            saveGame();
        }, 1000);
    }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… ---
    function buyPremium() {
        if(gameData.isPremium) return;
        
        if (gameData.score >= PREMIUM_COST) {
            tg.showConfirm(`Buy H-Coin Premium for ${PREMIUM_COST.toLocaleString()} coins?`, (ok) => {
                if(ok) {
                    gameData.score -= PREMIUM_COST;
                    gameData.isPremium = true;
                    gameData.maxEnergy += 5000;
                    gameData.energy = gameData.maxEnergy;
                    
                    checkPremiumVisuals();
                    updateUI();
                    saveGame();
                    tg.showAlert("Congratulations! You are now H-Coin Premium ğŸ’");
                    if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                }
            });
        } else {
            tg.showAlert(`You need ${PREMIUM_COST.toLocaleString()} coins to buy Premium!`);
            if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
        }
    }

    function checkPremiumVisuals() {
        const btn = document.getElementById('btn-buy-premium');
        const statusTxt = document.getElementById('premium-status-text');
        
        if (gameData.isPremium) {
            document.body.classList.add('is-premium');
            btn.innerText = "Active âœ…";
            btn.disabled = true;
            statusTxt.style.display = "block";
        } else {
            document.body.classList.remove('is-premium');
            btn.disabled = false;
        }
    }

    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ† ---
    document.getElementById('coin-btn').addEventListener('pointerdown', (e) => {
        e.preventDefault(); 
        let touches = e.getClientRects ? 1 : e.touches ? e.touches.length : 1; 
        
        if (turboActive || gameData.energy >= gameData.tapValue) {
            let baseVal = gameData.tapValue;
            if (gameData.isPremium) baseVal *= 2;
            let val = turboActive ? baseVal * 5 : baseVal;
            
            gameData.score += val;
            gameData.totalTaps++;
            if(!turboActive) gameData.energy -= gameData.tapValue;
            
            spawnParticle(e.clientX, e.clientY, `+${val}`);
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left - rect.width/2;
            const y = e.clientY - rect.top - rect.height/2;
            e.currentTarget.style.transform = `perspective(1000px) rotateX(${-y/10}deg) rotateY(${x/10}deg) scale(0.95)`;
            setTimeout(() => e.currentTarget.style.transform = 'scale(1)', 100);
            
            updateUI();
        }
    });

    function spawnParticle(x, y, txt) {
        const p = document.createElement('div');
        p.className = 'particle'; p.innerText = txt;
        p.style.left = x + 'px'; p.style.top = y + 'px';
        const tx = (Math.random() - 0.5) * 100 + 'px';
        const ty = (Math.random() * -100 - 50) + 'px';
        p.style.setProperty('--tx', tx);
        p.style.setProperty('--ty', ty);
        if(turboActive) p.style.color = '#ff4500';
        if(gameData.isPremium && !turboActive) p.style.color = '#d000ff'; 
        
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 800);
    }

    // --- Ø§Ù„ØµØ§Ø±ÙˆØ® (Turbo) ---
    function scheduleRocket() {
        setTimeout(() => {
            if(!turboActive && document.getElementById('mine-section').style.display !== 'none') {
                const r = document.createElement('div');
                r.className = 'turbo-rocket'; r.innerText = 'ğŸš€';
                r.style.left = Math.random() * 80 + 10 + '%';
                r.style.top = Math.random() * 60 + 20 + '%';
                r.onclick = () => {
                    turboActive = true;
                    document.body.classList.add('turbo-active');
                    document.getElementById('coin-visual').classList.add('turbo');
                    r.remove();
                    setTimeout(() => {
                        turboActive = false;
                        document.body.classList.remove('turbo-active');
                        document.getElementById('coin-visual').classList.remove('turbo');
                    }, 10000);
                };
                document.body.appendChild(r);
                setTimeout(() => r.remove(), 4000);
            }
            scheduleRocket();
        }, Math.random() * 15000 + 10000);
    }

    // --- Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ---
    function renderDaily() {
        const grid = document.getElementById('daily-grid');
        grid.innerHTML = '';
        const rewards = [500, 1000, 2500, 5000, 15000, 50000, 100000];
        const now = Date.now();
        const oneDay = 86400000;
        
        const isClaimable = (now - gameData.daily.lastClaim) > oneDay;
        const streak = gameData.daily.streak;

        rewards.forEach((val, i) => {
            const div = document.createElement('div');
            div.className = `daily-item ${i < streak ? 'claimed' : (i === streak && isClaimable ? 'active' : '')}`;
            div.innerHTML = `<div class="daily-day">Day ${i+1}</div><div class="daily-val">${val/1000}K</div>`;
            grid.appendChild(div);
        });

        const btn = document.getElementById('btn-claim-daily');
        if (isClaimable && streak < 7) {
            btn.disabled = false;
            btn.innerText = "Claim Reward";
            btn.onclick = () => {
                gameData.score += rewards[streak];
                gameData.daily.streak++;
                gameData.daily.lastClaim = Date.now();
                if(gameData.daily.streak >= 7) gameData.daily.streak = 0;
                if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                tg.showAlert(`You claimed ${rewards[streak]} coins!`);
                renderDaily(); updateUI(); saveGame();
            };
        } else {
            btn.disabled = true;
            btn.innerText = streak >= 7 ? "Cycle Completed" : "Come back tomorrow";
        }
    }

    // --- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… (Check + Story Logic) ---
    function renderTasks() {
        const list = document.getElementById('tasks-list');
        list.innerHTML = '';
        TASKS_DB.forEach(task => {
            const isDone = gameData.tasks.includes(task.id);
            const isStarted = gameData.startedTasks.includes(task.id);
            
            const div = document.createElement('div');
            div.className = 'task-row';
            div.style.opacity = isDone ? '0.5' : '1';
            
            let btnHtml = '';
            if (isDone) {
                btnHtml = 'âœ…';
            } else if (isStarted) {
                btnHtml = `<button class="btn-primary btn-check" style="width:auto; padding:5px 15px; font-size:12px;" onclick="checkTask('${task.id}')">Check</button>`;
            } else {
                btnHtml = `<button class="btn-primary" style="width:auto; padding:5px 15px; font-size:12px;" onclick="startTask('${task.id}')">Start</button>`;
            }

            div.innerHTML = `
                <div class="task-info">
                    <div class="task-title">${task.title}</div>
                    <div class="task-reward">+${task.reward.toLocaleString()}</div>
                </div>
                ${btnHtml}
            `;
            list.appendChild(div);
        });
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· (Ø®Ø§ØµØ© Ø§Ù„Ø§Ø³ØªÙˆØ±ÙŠ)
    function startTask(id) {
        const task = TASKS_DB.find(t => t.id === id);
        if(!task) return;

        // Ù…Ù†Ø·Ù‚ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªÙˆØ±ÙŠ Ù…Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        if(task.id === 'share_story') {
             const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "000";
             const inviteLink = `https://t.me/${BOT_USERNAME}?start=ref_${userId}`;
             const text = `ğŸ”¥ Join me on H-Coin Pro! Mining is live.\n${inviteLink}`;
             
             // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø°ÙŠ ÙŠÙØªØ­ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªÙˆØ±ÙŠ
             const url = `https://t.me/share/url?url=${encodeURIComponent(inviteLink)}&text=${encodeURIComponent(text)}`;
             tg.openTelegramLink(url);
        } else {
            if(task.url !== '#') tg.openLink(task.url);
        }

        if(!gameData.startedTasks.includes(id)) {
            gameData.startedTasks.push(id);
        }
        
        saveGame();
        renderTasks();
    }

    function checkTask(id) {
        const task = TASKS_DB.find(t => t.id === id);
        if(!task) return;

        if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        
        gameData.score += task.reward;
        gameData.tasks.push(id);
        gameData.startedTasks = gameData.startedTasks.filter(tid => tid !== id);
        
        tg.showAlert(`Task Verified! You got +${task.reward.toLocaleString()} coins.`);
        if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
        
        saveGame();
        renderTasks();
        updateUI();
    }

    // --- Ø§Ù„Ù„ÙŠØ¯Ø±Ø¨ÙˆØ±Ø¯ ÙˆØ§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ---
    function renderLeaderboard() {
        const list = document.getElementById('leaderboard-list');
        let users = [
            { name: "EVAR", score: 9500000 },
            { name: "i_Crypto", score: 8200000 },
            { name: "NotKing", score: 7100000 },
            { name: "You", score: gameData.score, self: true },
            { name: "Black_Demon", score: Math.max(1000, gameData.score - 5000) }
        ];
        
        users.sort((a,b) => b.score - a.score);

        list.innerHTML = '';
        users.forEach((u, i) => {
            const div = document.createElement('div');
            div.className = 'leaderboard-row';
            if(u.self) div.style.background = 'rgba(255, 215, 0, 0.1)';
            div.innerHTML = `
                <div class="rank-num rank-${i+1}">${i+1}</div>
                <div class="lb-user">
                    <div class="lb-avatar">${u.name.charAt(0)}</div>
                    <div>${u.name} ${u.self ? '(You)' : ''}</div>
                </div>
                <div class="lb-score">${u.score.toLocaleString()}</div>
            `;
            list.appendChild(div);
        });
    }

    // --- Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª ---
    function renderBoosts() {
        const list = document.getElementById('boosts-list');
        list.innerHTML = '';
        for (let key in BOOSTS) {
            const lvl = gameData.upgrades[key];
            const cost = Math.floor(BOOSTS[key].base * Math.pow(1.8, lvl));
            const isBot = key === 'bot';
            const maxed = isBot && lvl > 0;
            
            const div = document.createElement('div');
            div.className = 'card task-row';
            div.innerHTML = `
                <div>
                    <div style="font-weight:bold; font-size:16px;">${BOOSTS[key].name} <span style="color:var(--gold); font-size:12px;">Lvl ${lvl}</span></div>
                    <div style="color:#888; font-size:12px;">${BOOSTS[key].desc}</div>
                </div>
                <button class="btn-primary" style="width:auto;" onclick="buy('${key}')" ${maxed ? 'disabled' : ''}>
                    ${maxed ? 'Owned' : `ğŸ’° ${cost.toLocaleString()}`}
                </button>
            `;
            list.appendChild(div);
        }
    }

    function buy(key) {
        const lvl = gameData.upgrades[key];
        const cost = Math.floor(BOOSTS[key].base * Math.pow(1.8, lvl));
        if (gameData.score >= cost) {
            gameData.score -= cost;
            gameData.upgrades[key]++;
            if(key === 'multitap') gameData.tapValue++;
            if(key === 'energy') gameData.maxEnergy += 500;
            if(key === 'speed') gameData.regenRate++;
            
            renderBoosts(); updateUI();
            if(tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
        }
    }

    // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
    function updateUI() {
        document.getElementById('score').innerText = Math.floor(gameData.score).toLocaleString();
        document.getElementById('curr-energy').innerText = Math.floor(gameData.energy);
        document.getElementById('max-energy').innerText = gameData.maxEnergy.toLocaleString();
        document.getElementById('energy-fill').style.width = (gameData.energy / gameData.maxEnergy * 100) + '%';
        document.getElementById('profile-taps').innerText = gameData.totalTaps.toLocaleString();
        
        document.getElementById('profile-invites').innerText = gameData.invites.toLocaleString();

        const s = gameData.score;
        let rank = "Bronze I";
        let cls = "rank-bronze";
        
        if (s > 1000000) { rank = "Diamond ğŸ’"; cls = "rank-diamond"; }
        else if (s > 500000) { rank = "Gold III ğŸ¥‡"; cls = "rank-gold"; }
        else if (s > 200000) { rank = "Gold I ğŸ¥‡"; cls = "rank-gold"; }
        else if (s > 100000) { rank = "Silver II ğŸ¥ˆ"; cls = "rank-silver"; }
        else if (s > 50000) { rank = "Silver I ğŸ¥ˆ"; cls = "rank-silver"; }
        else if (s > 25000) { rank = "Bronze III ğŸ¥‰"; cls = "rank-bronze"; }
        else if (s > 10000) { rank = "Bronze II ğŸ¥‰"; cls = "rank-bronze"; }

        if(gameData.isPremium) rank += " (VIP)";

        document.getElementById('league-display').innerText = rank;
        
        if(!turboActive && !gameData.isPremium) document.body.className = cls;
        if(gameData.isPremium && !turboActive) document.body.className = "is-premium"; 
    }

    function regenEnergy() {
        if(gameData.energy < gameData.maxEnergy) {
            gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + gameData.regenRate);
            updateUI();
        }
    }

    function saveGame() {
        gameData.lastSave = Date.now();
        localStorage.setItem('hcoin_pro_v2', JSON.stringify(gameData));
    }

    function nav(tab, btn) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById('mine-section').style.display = 'none';
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        
        btn.classList.add('active');
        if(tab === 'mine') {
            document.getElementById('mine-section').style.display = 'flex';
        } else {
            document.getElementById(tab+'-section').style.display = 'block';
            if(tab === 'profile') renderLeaderboard(); 
        }
        if(tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
    }
    
    function connectWallet() {
        tg.showAlert("Wallet connection coming soon! ğŸ’¼");
    }

    window.onload = init;
</script>
</body>
</html>
